<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Linux Maker - Build</title>

  <!-- W3.CSS -->
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />

  <style>
    body {
      background-color: #1e1e1e;
      color: white;
      font-family: "Segoe UI", sans-serif;
    }
    header {
      background-color: #111;
    }
    .distro-btn {
      width: 100%;
      max-width: 300px;
      padding: 20px;
      margin: 10px auto;
      font-size: 18px;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .active {
      border: 2px solid #0af !important;
    }
    #final-screen {
      display: none;
    }
  </style>
</head>
<body class="w3-dark">

<!-- Navbar -->
<header class="w3-bar w3-black">
  <div class="w3-bar-item w3-large"><i class="fa-solid fa-terminal"></i> Linux Maker</div>
  <a href="/linux/maker/code" class="w3-bar-item w3-button w3-hover-blue"><i class="fa-solid fa-code"></i> Code</a>
  <a href="/linux/maker/build" class="w3-bar-item w3-button w3-hover-blue"><i class="fa-solid fa-hammer"></i> Build</a>
</header>

<!-- Build Section -->
<div class="w3-container w3-center w3-padding-32" id="build-screen">
  <h2><i class="fa-solid fa-box-open"></i> Choose Your Base Distro</h2>

  <button class="w3-button w3-dark-gray w3-round-large distro-btn" onclick="selectDistro('debian')" id="btn-debian">
    <i class="fa-brands fa-debian fa-2x w3-text-red"></i>
    <span><strong>Debian/Ubuntu</strong><br><small>Uses <code>apt</code></small></span>
  </button>

  <button class="w3-button w3-dark-gray w3-round-large distro-btn" onclick="selectDistro('arch')" id="btn-arch">
    <i class="fa-brands fa-linux fa-2x w3-text-blue"></i>
    <span><strong>Arch Linux</strong><br><small>Uses <code>pacman</code></small></span>
  </button>

  <button onclick="continueBuild()" id="continueBtn" class="w3-button w3-blue w3-round-large w3-margin-top" disabled>
    <i class="fa-solid fa-forward"></i> Continue
  </button>
</div>

<!-- Loading Screen -->
<div class="w3-container w3-center w3-padding-64" id="loading-screen" style="display: none;">
  <i class="fa-solid fa-circle-notch fa-spin fa-3x w3-margin-bottom"></i>
  <h3>Generating your Linux distro...</h3>
</div>

<!-- Final Screen -->
<div class="w3-container w3-center w3-padding-64" id="final-screen">
  <h2>ðŸŽ‰ Your distro is ready!</h2>
  <p>You can now copy your generated install script or share Linux Maker with your friends.</p>
  <button class="w3-button w3-green w3-round-large w3-margin-top" onclick="showScript()">
    <i class="fa-solid fa-terminal"></i> Show Script
  </button>
  <br><br>
  <button class="w3-button w3-gray w3-round-large" onclick="shareMaker()">
    <i class="fa-solid fa-share-nodes"></i> Share Linux Maker
  </button>
</div>

<!-- Output Script Box -->
<div id="script-output" class="w3-container w3-padding w3-small output-box w3-dark-gray w3-margin-top w3-center" style="display: none;">
  <pre id="scriptText" style="white-space: pre-wrap; word-break: break-all;"></pre>
  <button class="w3-button w3-light-blue w3-margin-top" onclick="copyOutput()">
    <i class="fa-solid fa-copy"></i> Copy Script
  </button>
</div>

<!-- Disclaimer -->
<footer class="w3-container w3-dark-gray w3-padding w3-center w3-small">
  <p><i class="fa-solid fa-triangle-exclamation"></i> We are <strong>not affiliated</strong> with Debian, Arch Linux, or any brands mentioned on this site. All logos and trademarks belong to their respective owners.</p>
</footer>

<!-- Blockly (for loading script) -->
<script src="https://unpkg.com/blockly/blockly.min.js"></script>

<script>
  let selectedDistro = "";
  const workspace = Blockly.inject(document.createElement("div"), { toolbox: null });

  Blockly.defineBlocksWithJsonArray([
    {
      "type": "run_cmd",
      "message0": "Run command %1",
      "args0": [{ "type": "field_input", "name": "CMD", "text": "echo Hello" }],
      "previousStatement": null,
      "nextStatement": null,
      "colour": 230
    },
    {
      "type": "install_pkg",
      "message0": "Install package %1",
      "args0": [{ "type": "field_input", "name": "PKG", "text": "firefox" }],
      "previousStatement": null,
      "nextStatement": null,
      "colour": 120
    }
  ]);

  window.addEventListener("load", () => {
    const saved = localStorage.getItem('linux_maker_blocks');
    if (saved) {
      const xml = Blockly.Xml.textToDom(saved);
      Blockly.Xml.domToWorkspace(xml, workspace);
    }
  });

  function selectDistro(name) {
    selectedDistro = name;
    document.getElementById("continueBtn").disabled = false;
    document.getElementById("btn-debian").classList.remove("active");
    document.getElementById("btn-arch").classList.remove("active");
    document.getElementById("btn-" + name).classList.add("active");
  }

  function continueBuild() {
    document.getElementById("build-screen").style.display = "none";
    document.getElementById("loading-screen").style.display = "block";
    setTimeout(() => {
      document.getElementById("loading-screen").style.display = "none";
      document.getElementById("final-screen").style.display = "block";
    }, 2000);
  }

  function showScript() {
    const topBlocks = workspace.getTopBlocks(true);
    let script = [];

    topBlocks.forEach(block => {
      while (block) {
        if (block.type === "run_cmd") {
          const cmd = block.getFieldValue("CMD");
          script.push(`echo ${cmd}`);
        } else if (block.type === "install_pkg") {
          const pkg = block.getFieldValue("PKG");
          if (selectedDistro === "debian") {
            script.push(`sudo apt-get install ${pkg} -y`);
          } else if (selectedDistro === "arch") {
            script.push(`sudo pacman -S ${pkg} --noconfirm`);
          }
        }
        block = block.getNextBlock();
      }
    });

    const output = script.join(" &&\n") || "# No blocks found.";
    document.getElementById("scriptText").textContent = output;
    document.getElementById("script-output").style.display = "block";
  }

  function copyOutput() {
    const text = document.getElementById("scriptText").textContent;
    navigator.clipboard.writeText(text).then(() => {
      alert("âœ… Script copied to clipboard!");
    });
  }

  function shareMaker() {
    navigator.clipboard.writeText("https://cattymod.github.io/linux/maker/").then(() => {
      alert("ðŸ“Ž Link copied! Share it with your friends!");
    });
  }
</script>

</body>
</html>
