<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Linux Maker</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Favicon -->
  <link rel="icon" href="https://cattymod.github.io/linux/assets/logo.png" />

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

  <!-- Monaco Editor -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs/loader.js"></script>

  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      background-color: #0d1117;
      color: #c9d1d9;
      font-family: system-ui, sans-serif;
    }
    #monacoEditor {
      width: 100%;
      height: 100%;
      background-color: #161b22;
      border-radius: 0.375rem;
    }

    /* Overlay styles */
    #overlay {
      position: fixed;
      inset: 0;
      background: rgba(13,17,23,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    #overlayContent {
      background: #161b22;
      padding: 2rem;
      border-radius: 0.5rem;
      max-width: 450px;
      width: 90%;
      box-shadow: 0 0 15px rgba(88,166,255,0.6);
      position: relative;
      color: #c9d1d9;
      font-size: 1rem;
      line-height: 1.5;
    }

    #overlayContent h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: #58a6ff;
      font-weight: 600;
    }

    #overlayClose {
      position: absolute;
      top: 0.5rem;
      right: 0.75rem;
      font-size: 1.5rem;
      font-weight: 700;
      color: #c9d1d9;
      cursor: pointer;
      user-select: none;
      transition: color 0.2s ease;
    }

    #overlayClose:hover {
      color: #ff7b72;
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Navbar -->
  <nav class="flex justify-between items-center px-6 py-3 border-b border-[#30363d]">
    <div class="flex items-center gap-3 text-[#7d8590] text-sm font-semibold uppercase tracking-wider">
      <i class="fas fa-terminal"></i> Linux Maker
    </div>
    <div class="text-[#7d8590] text-sm select-none">cattymod.github.io/linux</div>
  </nav>

  <div class="flex flex-1 overflow-hidden">

    <!-- Sidebar -->
    <aside class="bg-[#0d1117] border-r border-[#30363d] w-64 overflow-auto">
      <div class="p-5">
        <h3 class="text-[#f0f6fc] font-semibold mb-4 text-base">Quick Commands</h3>
        <div id="commandsContainer" class="flex flex-col gap-2"></div>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 flex flex-col overflow-hidden">

      <!-- Editor -->
      <section id="editorSection" class="flex flex-col flex-1">
        <header class="px-8 pt-8 pb-6 border-b border-[#30363d]">
          <h2 class="text-[#f0f6fc] font-semibold text-2xl mb-2">Build Your Linux Distribution</h2>
          <p class="text-[#7d8590] text-base">
            Use <code class="text-[#ff7b72] font-mono">RunCommand("...")</code>, <code class="text-[#ff7b72] font-mono">InstallPackage("...")</code>, and <code class="text-[#ff7b72] font-mono">echo("...")</code>
          </p>
        </header>

        <div class="flex-1 px-8 py-4">
          <div id="monacoEditor"></div>
        </div>

        <div class="px-8 py-6 border-t border-[#30363d] flex justify-center">
          <button
            id="buildBtn"
            class="bg-green-700 hover:bg-green-600 transition-colors text-white py-3 px-7 rounded-md font-medium flex items-center gap-2"
          >
            <i class="fas fa-rocket"></i> Build Distribution
          </button>
        </div>
      </section>

      <!-- Distro Choice -->
      <section
        id="distroChoice"
        class="hidden flex-col items-center justify-center p-12 text-center text-[#f0f6fc]"
      >
        <h2 class="text-3xl font-semibold mb-6">Choose Base Distribution</h2>
        <div class="flex flex-wrap gap-6 justify-center">
          <button class="distroBtn" data-distro="Debian">
            <i class="fab fa-ubuntu text-4xl mb-2"></i>
            <div>Debian</div>
          </button>
          <button class="distroBtn" data-distro="Arch Linux">
            <i class="fab fa-linux text-4xl mb-2"></i>
            <div>Arch Linux</div>
          </button>
          <button class="distroBtn" data-distro="Fedora">
            <i class="fab fa-fedora text-4xl mb-2"></i>
            <div>Fedora</div>
          </button>
          <button class="distroBtn" data-distro="Alpine">
            <i class="fas fa-mountain text-4xl mb-2"></i>
            <div>Alpine</div>
          </button>
          <button class="distroBtn" data-distro="Void">
            <i class="fas fa-circle-notch text-4xl mb-2"></i>
            <div>Void Linux</div>
          </button>
          <button class="distroBtn" data-distro="openSUSE">
            <i class="fa-brands fa-opensuse text-4xl mb-2"></i>
            <div>openSUSE</div>
          </button>
        </div>
        <button
          id="backToEditor"
          class="mt-8 border border-[#30363d] text-[#7d8590] px-4 py-2 rounded-md hover:bg-[#30363d]"
        >
          <i class="fas fa-arrow-left"></i> Back to Editor
        </button>
      </section>

      <!-- Output -->
      <section
        id="generatedSection"
        class="hidden p-12 text-center text-[#f0f6fc] flex flex-col items-center"
      >
        <h2 class="text-3xl font-semibold mb-6 flex items-center gap-2">
          <i class="fas fa-terminal text-[#58a6ff]"></i> Generated Command
        </h2>
        <div class="mb-4 font-semibold text-lg w-full max-w-3xl text-left" id="distroName"></div>
        <pre
          id="generatedCommand"
          class="bg-[#161b22] border border-[#30363d] p-4 rounded-md max-w-3xl w-full text-left text-sm font-mono whitespace-pre-wrap"
        ></pre>
        <div
          class="mt-6 flex items-center justify-center gap-4 flex-wrap text-sm max-w-3xl w-full"
        >
          <button
            id="copyBtn"
            class="bg-green-700 hover:bg-green-600 text-white px-4 py-2 rounded-md flex items-center gap-1"
          >
            <i class="fas fa-copy"></i> Copy Command
          </button>

          <button
            id="createAnotherBtn"
            class="bg-blue-700 hover:bg-blue-600 text-white px-4 py-2 rounded-md flex items-center gap-1"
          >
            <i class="fas fa-redo"></i> Create Another
          </button>

          <span class="text-[#7d8590] select-none">|</span>

          <button
            id="testDistroBtn"
            class="bg-purple-700 hover:bg-purple-600 text-white px-4 py-2 rounded-md flex items-center gap-1"
          >
            <i class="fas fa-vial"></i> Test my distro
          </button>
        </div>
      </section>

    </main>
  </div>

  <!-- Overlay -->
  <div id="overlay" class="flex">
    <div id="overlayContent">
<div id="overlayClose" title="Close overlay">&times;</div>
<h3>Test Your Distro</h3>
<p>
  To test your generated command, go to  
  <a
    href="https://distrosea.com/"
    target="_blank"
    rel="noopener"
    class="text-[#58a6ff] underline"
  >DistroSea</a>.
</p>
<p class="mt-3">
  On DistroSea, choose a distro that matches the one you picked in Linux Maker (e.g. Ubuntu for Debian, Arch Linux, etc).
</p>
<p class="mt-3">
  Once your session starts, open the Terminal in the web environment and paste the generated command into it.
</p>
<p class="mt-3">
  This lets you try your custom Linux distro build in a real environment — with no need to install anything!
</p>
    </div>
  </div>

  <!-- Disclaimer -->
  <div class="text-center text-[#7d8590] text-xs py-2 border-t border-[#30363d]">
    Not affiliated with any Linux distribution mentioned.
  </div>

  <!-- Footer -->
  <footer
    class="bg-[#161b22] border-t border-[#30363d] text-center p-4 text-[#7d8590] text-sm"
  >
    <i class="fas fa-code mr-1"></i> Powered by Monaco Editor • Built with ❤️ by CattyMod
  </footer>

  <!-- JavaScript -->
<script>
  // Load Monaco editor
  require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.41.0/min/vs' } });
  let editor;

  require(['vs/editor/editor.main'], function () {
    editor = monaco.editor.create(document.getElementById('monacoEditor'), {
      value: '',
      language: 'shell',
      theme: 'vs-dark',
      fontSize: 14,
      minimap: { enabled: false },
      wordWrap: 'on',
      automaticLayout: true,
      lineNumbers: 'on'
    });
  });

  // =======================
  // QUICK COMMANDS SETUP
  // =======================
  const quickCommandsByCategory = {
    Basic: [
      'RunCommand("echo Hello, Linux!")',
      'echo("This is echo syntax")',
      'RunCommand("clear")',
    ],
    Debian: [
      'InstallPackage("curl")',
      'InstallPackage("git")',
      'InstallPackage("firefox")',
      'RunCommand("sudo apt update && sudo apt upgrade -y")',
    ],
    "Package Management": [
      'InstallPackage("vim")',
      'InstallPackage("htop")',
      'InstallPackage("nano")',
    ],
    "Arch Linux": [
      'RunCommand("sudo pacman -Syu")',
      'InstallPackage("firefox")',
      'InstallPackage("base-devel")',
    ],
    Void: [
      'RunCommand("sudo xbps-install -Suv")',
      'InstallPackage("firefox")',
    ],
    Advanced: [
      'RunCommand("make")',
      'RunCommand("sudo systemctl reboot")',
    ]
  };

  const commandsContainer = document.getElementById("commandsContainer");
  commandsContainer.innerHTML = "";

  const categorySelect = document.createElement("select");
  categorySelect.id = "categorySelect";
  categorySelect.className = "w-full mb-4 bg-[#161b22] border border-[#30363d] rounded-md px-3 py-2 text-sm text-[#c9d1d9]";
  for (const cat in quickCommandsByCategory) {
    const option = document.createElement("option");
    option.value = cat;
    option.textContent = cat;
    categorySelect.appendChild(option);
  }
  commandsContainer.appendChild(categorySelect);

  const commandButtons = document.createElement("div");
  commandsContainer.appendChild(commandButtons);

  function loadCommands(category) {
    commandButtons.innerHTML = "";
    quickCommandsByCategory[category].forEach(cmd => {
      const btn = document.createElement("button");
      btn.textContent = cmd;
      btn.className = "w-full text-left bg-[#161b22] border border-[#30363d] rounded-md px-4 py-2 text-sm hover:bg-[#30363d] font-mono mb-1";
      btn.onclick = () => {
        const val = editor.getValue();
        editor.setValue(val + (val.trim() ? "\n" : "") + cmd);
      };
      commandButtons.appendChild(btn);
    });
  }

  categorySelect.onchange = () => loadCommands(categorySelect.value);
  loadCommands(categorySelect.value); // Load first category initially

  // =======================
  // BUILD SYSTEM
  // =======================
  const buildBtn = document.getElementById("buildBtn");
  const editorSection = document.getElementById("editorSection");
  const distroChoice = document.getElementById("distroChoice");
  const generatedSection = document.getElementById("generatedSection");
  const generatedCommand = document.getElementById("generatedCommand");
  const distroName = document.getElementById("distroName");

  function show(section) {
    editorSection.classList.add("hidden");
    distroChoice.classList.add("hidden");
    generatedSection.classList.add("hidden");
    section.classList.remove("hidden");
  }

  buildBtn.onclick = () => {
    if (!editor || !editor.getValue().trim()) return;
    show(distroChoice);
  };

  document.querySelectorAll(".distroBtn").forEach(btn => {
    btn.onclick = () => {
      const distro = btn.dataset.distro;
      distroName.textContent = distro;
      const lines = editor.getValue().split("\n").map(l => l.trim()).filter(Boolean);
      const cmds = [];

      lines.forEach(line => {
        const echoMatch = line.match(/^echo\("(.+)"\)$/);
        const runMatch = line.match(/^RunCommand\("(.+)"\)$/);
        const installMatch = line.match(/^InstallPackage\("(.+)"\)$/);

        if (echoMatch) {
          cmds.push(`echo ${echoMatch[1]}`);
        } else if (runMatch) {
          cmds.push(runMatch[1]);
        } else if (installMatch) {
          switch (distro) {
            case "Debian": cmds.push(`sudo apt install -y ${installMatch[1]}`); break;
            case "Arch Linux": cmds.push(`sudo pacman -S --noconfirm ${installMatch[1]}`); break;
            case "Fedora": cmds.push(`sudo dnf install -y ${installMatch[1]}`); break;
            case "Alpine": cmds.push(`sudo apk add ${installMatch[1]}`); break;
            case "Void": cmds.push(`sudo xbps-install -y ${installMatch[1]}`); break;
            case "openSUSE": cmds.push(`sudo zypper install -y ${installMatch[1]}`); break;
          }
        }
      });

      generatedCommand.textContent = cmds.join(" && ");
      show(generatedSection);
    };
  });

  document.getElementById("backToEditor").onclick = () => show(editorSection);

  document.getElementById("copyBtn").onclick = () => {
    navigator.clipboard.writeText(generatedCommand.textContent).then(() => {
      alert("Copied to clipboard!");
    });
  };

  document.getElementById("createAnotherBtn").onclick = () => {
    if (editor) editor.setValue("");
    show(editorSection);
  };

  // Overlay for "Test My Distro"
  const overlay = document.getElementById("overlay");
  const testBtn = document.getElementById("testDistroBtn");
  const closeOverlayBtn = document.getElementById("overlayClose");

  if (overlay && testBtn && closeOverlayBtn) {
    testBtn.onclick = () => {
      overlay.style.display = "flex";
    };
    closeOverlayBtn.onclick = () => {
      overlay.style.display = "none";
    };
  }
</script>

</body>
</html>
